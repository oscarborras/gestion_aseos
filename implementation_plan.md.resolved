# Plan de Implementación: Gestión de Aseos

Esta aplicación web permitirá gestionar el uso de los aseos en un instituto de secundaria, respetando los diseños proporcionados en la carpeta `stitch_aseos_dashboard` y utilizando la estructura de base de datos de [database_schema.sql](file:///home/oscar/Antigravity/gestion-aseos/database_schema.sql) mediante `supabase-local`.

## Objetivos Principales
* **Stack Tecnológico:** Next.js (App Router), Tailwind CSS, Lucide React, Supabase-local.
* **Estética:** Limpia y minimalista, priorizando `radius-2xl`. Textos de UI en Español, código en Inglés, comentarios en Español.
* **Navegación:** El menú lateral debe ser el mismo y fijo en todas las pantallas.
* **Autenticación:** El uso normal (Dashboard, Entradas, Salidas, Historial) no requerirá login. Las opciones de 'Ajustes' (Mantenimiento) e 'Importar' estarán protegidas y solo accesibles para el rol de 'admin' previa validación de contraseña.
* **Multiusuario por Aseo:** Soporte para múltiples alumnos concurrentes en un mismo aseo.
* **Componentización:** Convertir los [.html](file:///home/oscar/Antigravity/gestion-aseos/stitch_aseos_dashboard/restroom_dashboard_1/code.html) de Stitch en componentes de React reutilizables dentro de Next.js.

## Lógica de Negocio: Múltiples Alumnos por Aseo
La base de datos tiene las tablas: `alumnos`, `cursos`, `aseos`, `estados` (1=Disponible, 2=Ocupado, 3=Mantenimiento), `registros`.
* **Entrada (Register Entry):** 
  * Se selecciona uno o más alumnos y un aseo en el formulario. 
  * Se insertan múltiples filas en `registros` (una por alumno) con `fecha_entrada` y valores nulos para la salida.
  * Se actualiza la tabla `aseos` (estado "Ocupado" o ID 2), y se concatenan los datos de **todos** los alumnos seleccionados en las columnas `ocupado_por` y `curso_alumno`.
* **Salida (Register Exit & Review):**
  * Se registra la salida del alumno actualizando su fila en `registros` (añadiendo `fecha_salida`, `estado_salida`, `observaciones_salida`).
  * Se comprueba si el aseo tiene *otros* alumnos con registro abierto (donde `fecha_salida` IS NULL).
  * **Si quedan alumnos:** el aseo sigue "Ocupado" (ID 2) y se recalculan/mantienen concatenados los campos `ocupado_por` y `curso_alumno` restantes.
  * **Si no quedan alumnos:** el aseo pasa a estado "Disponible" (ID 1) y se limpian los campos `ocupado_por` y `curso_alumno`.
* **Seguridad - Rol Admin:**
  * La gestión del usuario administrador se realizará usando el sistema de autenticación de Supabase (Supabase Auth). 
  * Se añadirá una opción explícita de "Login" en el menú lateral.
  * Solo los usuarios autenticados tendrán acceso a las rutas `/mantenimiento` y `/alumnos/importar`. El uso normal (Dashboard, Entradas, Salidas, Historial) seguirá siendo público.

## Proposed Changes

### 1. Inicialización y Configuración Base
#### [NEW] `src/lib/supabase.ts` o Actions de Supabase
- Configuración del cliente Supabase conectándose a la instancia local definida en el MCP.
#### [NEW] `tailwind.config.ts` y `src/app/globals.css`
- Ajustes de `radius-2xl` y colores base consistentes con Stitch.

---

### 2. Conversión de Diseños Stitch a Next.js (Screens)

#### [NEW] `src/app/page.tsx` (Dashboard)
- Basado en `restroom_dashboard_1`.
- Visualización en tiempo real del estado de los aseos.
- Gráficas de uso usando Recharts (si es necesario según diseño).

#### [NEW] `src/app/entrada/page.tsx` (Register Entry)
- Basado en `register_entry`.
- Formulario para seleccionar alumno y aseo.
- Manejo de entradas concurrentes.

#### [NEW] `src/app/salida/page.tsx` (Register Exit & Review)
- Basado en `register_exit_&_review`.
- Formulario para seleccionar aseo, estudiante y evaluación del estado (`Bueno`, `Regular`, `Malo`) con observaciones.

#### [NEW] `src/app/historial/page.tsx` (History)
- Basado en `history`.
- Componente de tabla con shadcn/ui para listar registros pasados.

#### [NEW] `src/app/mantenimiento/page.tsx` (Maintenance)
- Basado en `configuración_de_mantenimiento`.
- Actualización manual de tabla `aseos` (motivo de mantenimiento).

#### [NEW] `src/app/alumnos/importar/page.tsx` (Importar Alumnos)
- Basado en `importar_listado_de_alumnos`.
- Lógica para parsear CSV o manual y popular tabla `alumnos` y `cursos`.

---



## Verification Plan
### Automated Tests
*Por definir si se solicitará integración con Jest/Playwright para tests E2E y unitarios de la lógica de negocio.*
### Manual Verification
1. Acceder al Dashboard y observar el estado "Libre" general.
2. Ingresar a la sección "Entrada", registrar Alumno A en "Aseo 1". Comprobar que "Aseo 1" pasa a "Ocupado".
3. Registrar Alumno B en el mismo "Aseo 1". Comprobar en Dashboard que ahora se muestran 2 alumnos.
4. Ingresar a "Salida", registrar salida de Alumno A con estado "Bueno". El "Aseo 1" debe seguir "Ocupado" por el Alumno B.
5. Registrar salida del Alumno B. "Aseo 1" debe pasar a estado "Libre".
6. Revisar el Historial de registros para asegurar integridad referencial.
